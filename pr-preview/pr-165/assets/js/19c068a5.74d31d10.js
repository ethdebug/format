(globalThis.webpackChunk_ethdebug_format_web=globalThis.webpackChunk_ethdebug_format_web||[]).push([[6684],{2338(){},6177(){},14636(e){function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=14636,e.exports=t},19429(e,t,n){"use strict";n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"implementation-guides/pointers/dereference-logic/dereference-logic","title":"The dereference() function","description":"Summary","source":"@site/docs/implementation-guides/pointers/dereference-logic/dereference-logic.mdx","sourceDirName":"implementation-guides/pointers/dereference-logic","slug":"/implementation-guides/pointers/dereference-logic/","permalink":"/format/pr-preview/pr-165/docs/implementation-guides/pointers/dereference-logic/","draft":false,"unlisted":false,"editUrl":"https://github.com/ethdebug/format/tree/main/packages/web/docs/implementation-guides/pointers/dereference-logic/dereference-logic.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"sidebar_label":"The dereference function"},"sidebar":"docsSidebar","previous":{"title":"Evaluating pointer expressions","permalink":"/format/pr-preview/pr-165/docs/implementation-guides/pointers/evaluating-expressions"},"next":{"title":"Generating regions on the fly","permalink":"/format/pr-preview/pr-165/docs/implementation-guides/pointers/dereference-logic/generating-regions"}}');var i=n(31085),s=n(71184),o=n(50507);const c={sidebar_position:5,sidebar_label:"The dereference function"},a="The dereference() function",l={},d=[{value:"Summary",id:"summary",level:2},{value:"<code>DereferenceOptions</code>",id:"dereferenceoptions",level:3},{value:"Control flow architecture",id:"control-flow-architecture",level:2}];function h(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",...(0,s.R)(),...e.components},{Details:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsxs)(t.h1,{id:"the-dereference-function",children:["The ",(0,i.jsx)(t.code,{children:"dereference()"})," function"]})}),"\n",(0,i.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsxs)(t.p,{children:["The pages in this section cover the internals of the ",(0,i.jsx)(t.code,{children:"dereference()"})," function\nin the ",(0,i.jsx)(t.strong,{children:"@ethdebug/pointers"})," reference implementation."]}),"\n",(0,i.jsx)(t.p,{children:"The full signature of this function is as follows:"}),"\n",(0,i.jsx)(o.A,{packageName:"@ethdebug/pointers",sourcePath:"src/dereference/index.ts",extract:(e,t)=>{const n=e.getFunction("dereference"),r=t.createSourceFile("dereference-summary.ts","",{overwrite:!0});for(const s of e.getImportDeclarations())r.addImportDeclaration(s.getStructure());const i=n.getLeadingCommentRanges().map((t=>e.getFullText().substring(t.getPos(),t.getEnd()))).join("\n");r.addFunction({name:n.getName(),parameters:n.getParameters().map(((e,t,n)=>({name:e.getName(),type:e.getType().getText(e),hasQuestionToken:e.hasQuestionToken()||e.hasInitializer(),leadingTrivia:"\n",trailingTrivia:t<n.length-1?void 0:"\n"}))),returnType:n.getReturnType().getText(n),hasDeclareKeyword:!0,isAsync:!0,leadingTrivia:`${i}\n`});return r.getFunction("dereference")}}),"\n",(0,i.jsx)(t.admonition,{type:"tip",children:(0,i.jsxs)(t.p,{children:["Remember from the\n",(0,i.jsx)(t.a,{href:"/docs/implementation-guides/pointers/types/cursors",children:"Cursors"})," section that a ",(0,i.jsx)(t.code,{children:"Cursor"}),"\nprovides a ",(0,i.jsx)(t.code,{children:"view(state: Machine.State)"})," method, which returns an ordered\ncollection of concrete ",(0,i.jsx)(t.code,{children:"Cursor.Region"})," objects."]})}),"\n",(0,i.jsx)(t.h3,{id:"dereferenceoptions",children:(0,i.jsx)(t.code,{children:"DereferenceOptions"})}),"\n",(0,i.jsxs)(t.p,{children:["Note the optional ",(0,i.jsx)(t.code,{children:"options: DereferenceOptions"})," argument. This argument\nallows for specifying additional information upfront that is necessary for\nviewing the cursor later. Currently, this is needed only for pointers that\ncompose stack-located regions."]}),"\n",(0,i.jsx)(o.A,{packageName:"@ethdebug/pointers",sourcePath:"src/dereference/index.ts",extract:e=>e.getInterface("DereferenceOptions")}),"\n",(0,i.jsx)(t.h2,{id:"control-flow-architecture",children:"Control flow architecture"}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"dereference()"})," function itself performs two tasks:"]}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:['Create a "simple cursor": a function that takes a machine state and\nproduces an asynchronous list of ',(0,i.jsx)(t.code,{children:"Cursor.Region"}),"s."]}),"\n",(0,i.jsxs)(t.li,{children:["Adapt this simple cursor to conform to the full ",(0,i.jsx)(t.code,{children:"Cursor"})," interface"]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Within the process of creating this simple cursor it gets more interesting:\nby leveraging JavaScript's\n",(0,i.jsx)(t.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AsyncIterator",children:"AsyncIterator"}),"s,\nthe implementation can compute regions on the fly by recursively breaking down\npointers into their nested child pointers."]}),"\n",(0,i.jsxs)(t.p,{children:["Since the desired end-result of ",(0,i.jsx)(t.code,{children:"dereference()"})," is an object that can turn\na pointer into its composite ordered list of concrete regions at a particular\nmachine state, this implementation separates the concerns of generating this\nlist from converting this list into the promised return interface."]}),"\n",(0,i.jsxs)(t.p,{children:["To generate this list asynchronously on the fly, the implementation uses a\n",(0,i.jsx)(t.em,{children:"stack of processing requests"}),' (which it calls "memos"), initially populated\nwith a request to dereference the root pointer. Each memo represents a state\nor context change in some form: either a request to dereference a pointer or\nsub-pointer, a request to save a set of regions by their names, or a request\nto save the computed values of a set of variables by their identifiers.']}),"\n",(0,i.jsx)(t.p,{children:"The other pages in this section proceed to go into more detail."}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsxs)("summary",{children:["See the full ",(0,i.jsx)(t.code,{children:"src/dereference/index.ts"})," module"]}),(0,i.jsx)(o.A,{packageName:"@ethdebug/pointers",sourcePath:"src/dereference/index.ts"})]})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},29034(){},33288(){},37711(){},50507(e,t,n){"use strict";n.d(t,{A:()=>m});var r=n(54034),i=n.n(r),s=n(76827),o=n(6181);var c=n(14041),a=n(40665),l=n(31085);function d({code:e,links:t,...n}){const r=(0,c.useRef)(null),[s,o]=(0,c.useState)(null);return(0,c.useEffect)((()=>{function e(){if(r.current){const e=r.current.querySelector("pre > code");if(e){const n=Array.from(e.childNodes).flatMap((e=>h(e,t)));o((0,l.jsx)("pre",{className:e.parentElement?.className,children:(0,l.jsx)("code",{className:e.className,children:n})}))}}}e();const n=new MutationObserver(e);return r.current&&n.observe(r.current,{childList:!0,subtree:!0}),()=>n.disconnect()}),[e,t]),s||(0,l.jsx)("div",{ref:r,children:(0,l.jsx)(i(),{...n,children:e})})}function h(e,t){return e.nodeType===Node.TEXT_NODE?function(e,t){const n=[],r=e.textContent||"";let i=0;for(const[s,o]of Object.entries(t)){let e=r.indexOf(s,i);for(;-1!==e;)e>i&&n.push(r.slice(i,e)),n.push((0,l.jsx)(a.A,{to:o,className:"linked-code-block-link",children:s},`${s}-${e}`)),i=e+s.length,e=r.indexOf(s,i)}i<r.length&&n.push(r.slice(i));return n}(e,t):e.nodeType===Node.ELEMENT_NODE?function(e,t){const n=e.tagName.toLowerCase(),r={key:u++,className:e.className};e.style&&e.style.cssText&&(r.style=function(e){const t={};for(const n of e.split(";"))if(n){const[e,r]=n.split(":");if(e&&r){t[e.trim().replace(/-./g,(e=>e[1].toUpperCase()))]=r.trim()}}return t}(e.style.cssText));if(p.has(n))return c.createElement(n,r);const i=Array.from(e.childNodes).flatMap((e=>h(e,t)));return c.createElement(n,r,i)}(e,t):[]}let u=0;const p=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"]);function m({packageName:e,sourcePath:t,includePackageNameInTitle:n=!1,extract:r,links:c={},...a}){const h=function(e){const{packages:t}=(0,o.P_)("project-code-plugin");if(!(e in t))throw new Error(`Unknown package name ${e}`);const{sourceFiles:n}=t[e],r=new s.MMY({useInMemoryFileSystem:!0});for(const{filePath:i,text:s}of n)r.createSourceFile(i,s,{overwrite:!0});return r}(e),u=h.getSourceFileOrThrow(t),p=r?r(u,h):u,m=p.getFullText().trim(),f=!r,g=n?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("strong",{children:e})," ",t]}):t;return Object.keys(c).length>0?(0,l.jsx)(d,{code:m,links:c,language:"typescript",...a}):(0,l.jsx)(i(),{language:"typescript",...f?{title:g,showLineNumbers:!0}:{showLineNumbers:!1},...a,children:p.getFullText().trim()})}},66052(){},89978(){},91797(){},92560(){}}]);