"use strict";(globalThis.webpackChunk_ethdebug_format_web=globalThis.webpackChunk_ethdebug_format_web||[]).push([[3165],{792(e,t,n){n.d(t,{A:()=>d});n(14041);var s=n(40665);const r="container_Hrln",i="link_y57m",o="label_feh8",a="schema_kJnE",l="arrow_YbSg";var c=n(31085);function d({schema:e,href:t}){return(0,c.jsx)("div",{className:r,children:(0,c.jsxs)(s.A,{to:t,className:i,children:[(0,c.jsx)("span",{className:o,children:"Schema:"}),(0,c.jsx)("span",{className:a,children:e}),(0,c.jsx)("span",{className:l,children:"\u2192"})]})})}},38532(e,t,n){n.d(t,{C:()=>E,rM:()=>P});var s=n(31085),r=n(14041),i=n(70396);function o(e){return e.toHex()}function a(e={}){const{initialPointer:t=null,initialStateSpec:n={},autoResolve:s=!0}=e,[o,a]=(0,r.useState)(t),[l,c]=(0,r.useState)(n),[d,u]=(0,r.useState)(!1),[h,m]=(0,r.useState)(null),[p,g]=(0,r.useState)(null),f=(0,r.useCallback)(((e,t)=>{c((n=>({...n,[e]:t})))}),[]),x=(0,r.useCallback)((async()=>{if(!o)return m(null),void g(null);u(!0),g(null);try{const e=function(e){const t=(e.stack||[]).map((e=>"string"==typeof e?i.B.fromHex(e).padUntilAtLeast(32):i.B.fromUint(e).padUntilAtLeast(32))),n=e.memory?i.B.fromHex(e.memory):i.B.zero(),s=new Map;for(const[c,d]of Object.entries(e.storage||{})){const e=i.B.fromHex(c).padUntilAtLeast(32).toHex();s.set(e,i.B.fromHex(d).padUntilAtLeast(32))}const r=e.calldata?i.B.fromHex(e.calldata):i.B.zero(),o=e.returndata?i.B.fromHex(e.returndata):i.B.zero(),a=e.code?i.B.fromHex(e.code):i.B.zero(),l=new Map;for(const[c,d]of Object.entries(e.transient||{})){const e=i.B.fromHex(c).padUntilAtLeast(32).toHex();l.set(e,i.B.fromHex(d).padUntilAtLeast(32))}return{get traceIndex(){return Promise.resolve(e.traceIndex??0n)},get programCounter(){return Promise.resolve(e.programCounter??0n)},get opcode(){return Promise.resolve(e.opcode??"STOP")},stack:{get length(){return Promise.resolve(BigInt(t.length))},async peek({depth:e,slice:n}){const s=Number(e);if(s>=t.length)throw new Error(`Stack underflow: depth ${e} exceeds stack size`);const r=t[s];if(!n)return r;const{offset:o,length:a}=n,l=32-Number(o)-Number(a),c=l+Number(a);return i.B.fromBytes(r.slice(l,c))}},memory:{get length(){return Promise.resolve(BigInt(n.length))},async read({slice:e}){const{offset:t,length:s}=e,r=Number(t),o=r+Number(s);if(o>n.length){const e=new Uint8Array(Number(s)),t=Math.max(0,n.length-r);return t>0&&r<n.length&&e.set(n.slice(r,r+t),0),i.B.fromBytes(e)}return i.B.fromBytes(n.slice(r,o))}},storage:{async read({slot:e,slice:t}){const n=e.padUntilAtLeast(32).toHex(),r=s.get(n)||i.B.zero().padUntilAtLeast(32);if(!t)return r;const{offset:o,length:a}=t,l=32-Number(o)-Number(a),c=l+Number(a);return i.B.fromBytes(r.slice(l,c))}},calldata:{get length(){return Promise.resolve(BigInt(r.length))},async read({slice:e}){const{offset:t,length:n}=e,s=Number(t),o=s+Number(n);if(o>r.length){const e=new Uint8Array(Number(n)),t=Math.max(0,r.length-s);return t>0&&s<r.length&&e.set(r.slice(s,s+t),0),i.B.fromBytes(e)}return i.B.fromBytes(r.slice(s,o))}},returndata:{get length(){return Promise.resolve(BigInt(o.length))},async read({slice:e}){const{offset:t,length:n}=e,s=Number(t),r=s+Number(n);if(r>o.length){const e=new Uint8Array(Number(n)),t=Math.max(0,o.length-s);return t>0&&s<o.length&&e.set(o.slice(s,s+t),0),i.B.fromBytes(e)}return i.B.fromBytes(o.slice(s,r))}},code:{get length(){return Promise.resolve(BigInt(a.length))},async read({slice:e}){const{offset:t,length:n}=e,s=Number(t),r=s+Number(n);if(r>a.length){const e=new Uint8Array(Number(n)),t=Math.max(0,a.length-s);return t>0&&s<a.length&&e.set(a.slice(s,s+t),0),i.B.fromBytes(e)}return i.B.fromBytes(a.slice(s,r))}},transient:{async read({slot:e,slice:t}){const n=e.padUntilAtLeast(32).toHex(),s=l.get(n)||i.B.zero().padUntilAtLeast(32);if(!t)return s;const{offset:r,length:o}=t,a=32-Number(r)-Number(o),c=a+Number(o);return i.B.fromBytes(s.slice(a,c))}}}}(l),t=await(0,i.D)(o,{state:e}),n=await t.view(e),s=new Map;for(const i of n.regions)try{const e=await n.read(i);s.set(i,e)}catch{}const r={};for(const i of n.regions)"name"in i&&"string"==typeof i.name&&(r[i.name]||(r[i.name]=[]),r[i.name].push(i));const a={};for(const[i,o]of Object.entries(r))o.length>0&&(a[i]=o[o.length-1]);m({regions:[...n.regions],values:s,namedRegions:r,lookup:a})}catch(e){g(e instanceof Error?e:new Error(String(e))),m(null)}finally{u(!1)}}),[o,l]),v=(0,r.useCallback)((()=>{a(t),c(n),m(null),g(null)}),[t,n]);return(0,r.useEffect)((()=>{s&&x()}),[s,x]),{pointer:o,stateSpec:l,isResolving:d,result:h,error:p,setPointer:a,setStateSpec:c,updateStateSpec:f,resolve:x,reset:v}}const l=(0,r.createContext)(void 0);function c(){const e=(0,r.useContext)(l);if(void 0===e)throw new Error("usePointerResolverContext must be used within a PointerResolverProvider");return e}function d({children:e,...t}){const n=a(t);return(0,s.jsx)(l.Provider,{value:n,children:e})}function u(e){return"location"in e&&"string"==typeof e.location?e.location:"unknown"}function h(e){const t=[u(e)];if("slot"in e&&void 0!==e.slot){const n=o(e.slot);t.push(`slot: ${n}`)}if("offset"in e&&void 0!==e.offset){const n=o(e.offset);t.push(`offset: ${n}`)}if("length"in e&&void 0!==e.length){const n=o(e.length);t.push(`length: ${n}`)}return t.join(", ")}function m({regions:e,selectedName:t,onRegionClick:n}){const r=Object.keys(e).sort();return 0===r.length?(0,s.jsx)("div",{className:"region-map region-map-empty",children:(0,s.jsx)("span",{className:"region-map-empty-text",children:"No named regions"})}):(0,s.jsx)("div",{className:"region-map",children:r.map((r=>{const i=e[r],o=r===t;return(0,s.jsxs)("div",{className:"region-map-entry "+(o?"selected":""),children:[(0,s.jsx)("div",{className:"region-map-name",children:r}),(0,s.jsx)("div",{className:"region-map-regions",children:i.map(((e,t)=>{const i=u(e),o=function(e){return{storage:"region-storage",memory:"region-memory",stack:"region-stack",calldata:"region-calldata",returndata:"region-returndata",code:"region-code",transient:"region-transient"}[e]||"region-unknown"}(i);return(0,s.jsxs)("div",{className:`region-map-region ${o}`,onClick:()=>n?.(r,e),role:"button",tabIndex:0,onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||n?.(r,e)},children:[(0,s.jsx)("span",{className:"region-location-badge",children:i}),(0,s.jsx)("span",{className:"region-details",children:h(e)})]},t)}))})]},r)}))})}function p({region:e,value:t,showFullValues:n,index:r}){const i=function(e){return"location"in e&&"string"==typeof e.location?e.location:"unknown"}(e),a=function(e){return{storage:"region-storage",memory:"region-memory",stack:"region-stack",calldata:"region-calldata",returndata:"region-returndata",code:"region-code",transient:"region-transient"}[e]||"region-unknown"}(i),l="name"in e?e.name:void 0,c=t?n?o(t):function(e,t=10){const n=e.toHex();if(n.length<=t+2)return n;const s=Math.floor((t-2)/2),r=t-2-s;return`${n.slice(0,2+s)}...${n.slice(-r)}`}(t,16):"(no value)";return(0,s.jsxs)("div",{className:`region-output-item ${a}`,children:[(0,s.jsxs)("div",{className:"region-output-header",children:[(0,s.jsxs)("span",{className:"region-output-index",children:["#",r+1]}),(0,s.jsx)("span",{className:"region-location-badge",children:i}),l&&(0,s.jsx)("span",{className:"region-name-badge",children:l})]}),(0,s.jsxs)("div",{className:"region-output-details",children:["slot"in e&&void 0!==e.slot&&(0,s.jsxs)("div",{className:"region-output-field",children:[(0,s.jsx)("span",{className:"region-field-label",children:"slot:"}),(0,s.jsx)("code",{className:"region-field-value",children:o(e.slot)})]}),"offset"in e&&void 0!==e.offset&&(0,s.jsxs)("div",{className:"region-output-field",children:[(0,s.jsx)("span",{className:"region-field-label",children:"offset:"}),(0,s.jsx)("code",{className:"region-field-value",children:o(e.offset)})]}),"length"in e&&void 0!==e.length&&(0,s.jsxs)("div",{className:"region-output-field",children:[(0,s.jsx)("span",{className:"region-field-label",children:"length:"}),(0,s.jsx)("code",{className:"region-field-value",children:o(e.length)})]})]}),(0,s.jsxs)("div",{className:"region-output-value",children:[(0,s.jsx)("span",{className:"region-value-label",children:"value:"}),(0,s.jsx)("code",{className:"region-value-data "+(t?"":"no-value"),title:t?o(t):void 0,children:c})]})]})}function g({regions:e,values:t,showFullValues:n=!1}){return 0===e.length?(0,s.jsx)("div",{className:"region-output region-output-empty",children:(0,s.jsx)("span",{className:"region-output-empty-text",children:"No regions resolved"})}):(0,s.jsxs)("div",{className:"region-output",children:[(0,s.jsxs)("div",{className:"region-output-summary",children:[e.length," region",1!==e.length?"s":""," resolved"]}),(0,s.jsx)("div",{className:"region-output-list",children:e.map(((e,r)=>(0,s.jsx)(p,{region:e,value:t.get(e),showFullValues:n,index:r},r)))})]})}function f({storage:e,onChange:t}){const n=Object.entries(e);return(0,s.jsxs)("div",{className:"state-editor-section",children:[(0,s.jsxs)("div",{className:"state-editor-header",children:[(0,s.jsx)("span",{children:"Storage"}),(0,s.jsx)("button",{className:"state-editor-add-btn",onClick:()=>{const s=`0x${n.length.toString(16).padStart(2,"0")}`;t({...e,[s]:"0x00"})},type:"button",children:"+ Add"})]}),0===n.length?(0,s.jsx)("div",{className:"state-editor-empty",children:"No storage entries"}):(0,s.jsx)("div",{className:"state-editor-entries",children:n.map((([n,r])=>(0,s.jsxs)("div",{className:"state-editor-entry",children:[(0,s.jsx)("input",{className:"state-editor-input slot",value:n,onChange:s=>((n,s)=>{const r={...e},i=r[n];delete r[n],s&&(r[s]=i),t(r)})(n,s.target.value),placeholder:"slot (hex)"}),(0,s.jsx)("span",{className:"state-editor-arrow",children:"="}),(0,s.jsx)("input",{className:"state-editor-input value",value:r,onChange:s=>((n,s)=>{t({...e,[n]:s})})(n,s.target.value),placeholder:"value (hex)"}),(0,s.jsx)("button",{className:"state-editor-remove-btn",onClick:()=>(n=>{const s={...e};delete s[n],t(s)})(n),type:"button","aria-label":"Remove entry",children:"\xd7"})]},n)))})]})}function x({stack:e,onChange:t}){return(0,s.jsxs)("div",{className:"state-editor-section",children:[(0,s.jsxs)("div",{className:"state-editor-header",children:[(0,s.jsx)("span",{children:"Stack (top first)"}),(0,s.jsx)("button",{className:"state-editor-add-btn",onClick:()=>{t([...e,"0x00"])},type:"button",children:"+ Add"})]}),0===e.length?(0,s.jsx)("div",{className:"state-editor-empty",children:"Empty stack"}):(0,s.jsx)("div",{className:"state-editor-entries",children:e.map(((n,r)=>(0,s.jsxs)("div",{className:"state-editor-entry",children:[(0,s.jsxs)("span",{className:"state-editor-index",children:["[",r,"]"]}),(0,s.jsx)("input",{className:"state-editor-input value",value:"bigint"==typeof n?`0x${n.toString(16)}`:n,onChange:n=>((n,s)=>{const r=[...e];r[n]=s,t(r)})(r,n.target.value),placeholder:"value (hex)"}),(0,s.jsx)("button",{className:"state-editor-remove-btn",onClick:()=>(n=>{const s=[...e];s.splice(n,1),t(s)})(r),type:"button","aria-label":"Remove entry",children:"\xd7"})]},r)))})]})}function v({memory:e,onChange:t}){return(0,s.jsxs)("div",{className:"state-editor-section",children:[(0,s.jsx)("div",{className:"state-editor-header",children:(0,s.jsx)("span",{children:"Memory"})}),(0,s.jsx)("textarea",{className:"state-editor-textarea",value:e||"",onChange:e=>t(e.target.value),placeholder:"0x... (hex bytes)",rows:3})]})}function j({showPointerInput:e=!0,showStateEditor:t=!0,showControls:n=!0,showFullValues:i=!1}){const{pointer:o,stateSpec:a,isResolving:l,result:d,error:u,setPointer:h,updateStateSpec:p,resolve:j}=c(),[y,b]=(0,r.useState)(o?JSON.stringify(o,null,2):""),[w,k]=(0,r.useState)(null),N=(0,r.useCallback)((e=>{if(b(e),k(null),e.trim())try{const t=JSON.parse(e);h(t)}catch(t){k(t instanceof Error?t.message:"Invalid JSON")}else h(null)}),[h]);return(0,s.jsxs)("div",{className:"resolution-visualizer",children:[(0,s.jsxs)("div",{className:"resolution-visualizer-inputs",children:[e&&(0,s.jsxs)("div",{className:"resolution-visualizer-panel pointer-panel",children:[(0,s.jsx)("h4",{className:"panel-title",children:"Pointer Definition"}),(0,s.jsx)("textarea",{className:"pointer-input",value:y,onChange:e=>N(e.target.value),placeholder:'{"location": "storage", "slot": 0}',rows:10}),w&&(0,s.jsx)("div",{className:"pointer-parse-error",children:w})]}),t&&(0,s.jsxs)("div",{className:"resolution-visualizer-panel state-panel",children:[(0,s.jsx)("h4",{className:"panel-title",children:"Machine State"}),(0,s.jsxs)("div",{className:"state-editor",children:[(0,s.jsx)(f,{storage:a.storage||{},onChange:e=>p("storage",e)}),(0,s.jsx)(x,{stack:a.stack||[],onChange:e=>p("stack",e)}),(0,s.jsx)(v,{memory:a.memory,onChange:e=>p("memory",e)})]})]})]}),n&&(0,s.jsx)("div",{className:"resolution-visualizer-controls",children:(0,s.jsx)("button",{className:"resolve-button",onClick:()=>j(),disabled:l||!o,type:"button",children:l?"Resolving...":"Resolve Pointer"})}),(0,s.jsxs)("div",{className:"resolution-visualizer-output",children:[u&&(0,s.jsxs)("div",{className:"resolution-error",children:[(0,s.jsx)("h4",{children:"Resolution Error"}),(0,s.jsx)("pre",{children:u.message})]}),d&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"resolution-visualizer-panel regions-panel",children:[(0,s.jsx)("h4",{className:"panel-title",children:"Named Regions"}),(0,s.jsx)(m,{regions:d.namedRegions})]}),(0,s.jsxs)("div",{className:"resolution-visualizer-panel output-panel",children:[(0,s.jsx)("h4",{className:"panel-title",children:"Resolved Output"}),(0,s.jsx)(g,{regions:d.regions,values:d.values,showFullValues:i})]})]})]})]})}var y=n(49499);const b=(0,r.createContext)(null);function w({children:e,initialPointer:t=null,initialState:n={},initialOpen:i=!1}){const[o,a]=(0,r.useState)(t),[l,c]=(0,r.useState)(n),[d,u]=(0,r.useState)(i),h=(0,r.useCallback)((()=>u(!0)),[]),m=(0,r.useCallback)((()=>u(!1)),[]),p=(0,r.useCallback)((()=>u((e=>!e))),[]),g=(0,r.useCallback)(((e,t={})=>{a(e),c(t),u(!0)}),[]);return(0,s.jsx)(b.Provider,{value:{pointer:o,stateSpec:l,isOpen:d,loadExample:g,openDrawer:h,closeDrawer:m,toggleDrawer:p,setPointer:a,setStateSpec:c},children:e})}function k(){return(0,s.jsx)(y.A,{fallback:null,children:()=>(0,s.jsx)(N,{})})}function N(){const{pointer:e,stateSpec:t,isOpen:n,toggleDrawer:i,closeDrawer:o}=function(){const e=(0,r.useContext)(b);if(!e)throw new Error("usePointerPlayground must be used within a PointerPlaygroundProvider");return e}(),[a,l]=(0,r.useState)((()=>Math.round(.4*window.innerHeight))),[c,u]=(0,r.useState)(!1),h=(0,r.useRef)(null),[m,p]=(0,r.useState)(0);(0,r.useEffect)((()=>{p((e=>e+1))}),[e,t]);const g=(0,r.useCallback)((e=>{e.preventDefault(),u(!0)}),[]);return(0,r.useEffect)((()=>{if(!c)return;const e=e=>{const t="touches"in e?e.touches[0].clientY:e.clientY,n=window.innerHeight,s=n-t,r=.85*n;l(Math.max(200,Math.min(s,r)))},t=()=>{u(!1)};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),document.addEventListener("touchmove",e),document.addEventListener("touchend",t),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t),document.removeEventListener("touchmove",e),document.removeEventListener("touchend",t)}}),[c]),(0,r.useEffect)((()=>{const e=e=>{"Escape"===e.key&&n&&o()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[n,o]),n?(0,s.jsxs)("div",{ref:h,className:"pointer-drawer open "+(c?"resizing":""),style:{"--drawer-height":`${a}px`},children:[(0,s.jsx)("div",{className:"pointer-drawer-resize-handle",onMouseDown:g,onTouchStart:g,children:(0,s.jsx)("div",{className:"resize-handle-bar"})}),(0,s.jsxs)(d,{initialPointer:e,initialStateSpec:t,autoResolve:!0,children:[(0,s.jsx)($,{toggleDrawer:i,closeDrawer:o}),(0,s.jsx)("div",{className:"pointer-drawer-content",children:(0,s.jsx)(j,{showPointerInput:!0,showStateEditor:!0,showControls:!1,showFullValues:!1})})]},m)]}):(0,s.jsx)("div",{ref:h,className:"pointer-drawer closed",style:{"--drawer-height":`${a}px`},children:(0,s.jsx)("div",{className:"pointer-drawer-header",children:(0,s.jsxs)("button",{className:"pointer-drawer-toggle",onClick:i,type:"button","aria-expanded":!1,"aria-label":"Open pointer playground",children:[(0,s.jsx)("span",{className:"toggle-icon",children:"\u25b2"}),(0,s.jsx)("span",{className:"toggle-text",children:"Pointer Playground"})]})})})}function $({toggleDrawer:e,closeDrawer:t}){const{pointer:n,isResolving:r,resolve:i}=c();return(0,s.jsxs)("div",{className:"pointer-drawer-header",children:[(0,s.jsxs)("button",{className:"pointer-drawer-toggle",onClick:e,type:"button","aria-expanded":!0,"aria-label":"Close pointer playground",children:[(0,s.jsx)("span",{className:"toggle-icon",children:"\u25bc"}),(0,s.jsx)("span",{className:"toggle-text",children:"Pointer Playground"})]}),(0,s.jsxs)("div",{className:"pointer-drawer-header-actions",children:[(0,s.jsx)("button",{className:"resolve-button",onClick:()=>i(),disabled:r||!n,type:"button",children:r?"Resolving...":"Resolve Pointer"}),(0,s.jsx)("button",{className:"pointer-drawer-close",onClick:t,type:"button","aria-label":"Close",children:"\u2715"})]})]})}var C=n(54034),S=n.n(C);function E({pointer:e,state:t={},title:n,description:r,showCode:i=!0}){const o=JSON.stringify(e,null,2);return(0,s.jsxs)("div",{className:"pointer-example",children:[n&&(0,s.jsx)("div",{className:"pointer-example-title",children:n}),r&&(0,s.jsx)("div",{className:"pointer-example-description",children:r}),(0,s.jsxs)("div",{className:"pointer-example-content",children:[i&&(0,s.jsx)(S(),{language:"json",className:"pointer-example-code",children:o}),(0,s.jsx)(y.A,{fallback:null,children:()=>(0,s.jsx)(R,{pointer:e,state:t,showCode:i})})]})]})}function R({pointer:e,state:t,showCode:n}){const i=(0,r.useContext)(b);if(!i)return null;return(0,s.jsxs)("button",{className:"pointer-example-try-btn "+(n?"":"standalone"),onClick:()=>{i.loadExample(e,t)},type:"button",title:"Load this example in the Pointer Playground",children:[(0,s.jsx)("span",{className:"try-btn-icon",children:"\u25b6"}),(0,s.jsx)("span",{className:"try-btn-text",children:"Try it"})]})}function P({children:e,initialPointer:t,initialState:n}){return(0,s.jsx)(y.A,{fallback:(0,s.jsx)("div",{className:"pointer-playground-fallback",children:e}),children:()=>(0,s.jsxs)(w,{initialPointer:t??null,initialState:n,initialOpen:!1,children:[(0,s.jsx)("div",{className:"pointer-playground-content",children:e}),(0,s.jsx)(k,{})]})})}},68969(e,t,n){n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>d,default:()=>p,frontMatter:()=>c,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"core-schemas/pointers/expressions","title":"Expressions","description":"<SpecLink","source":"@site/docs/core-schemas/pointers/expressions.mdx","sourceDirName":"core-schemas/pointers","slug":"/core-schemas/pointers/expressions","permalink":"/format/pr-preview/pr-168/docs/core-schemas/pointers/expressions","draft":false,"unlisted":false,"editUrl":"https://github.com/ethdebug/format/tree/main/packages/web/docs/core-schemas/pointers/expressions.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Regions","permalink":"/format/pr-preview/pr-168/docs/core-schemas/pointers/regions"},"next":{"title":"Collections","permalink":"/format/pr-preview/pr-168/docs/core-schemas/pointers/collections"}}');var r=n(31085),i=n(71184),o=n(792),a=n(87270),l=n(38532);const c={sidebar_position:3},d="Expressions",u={},h=[{value:"Why expressions are needed",id:"why-expressions-are-needed",level:2},{value:"Arithmetic expressions",id:"arithmetic-expressions",level:2},{value:"<code>$sum</code> \u2014 Addition",id:"sum--addition",level:3},{value:"<code>$difference</code> \u2014 Subtraction",id:"difference--subtraction",level:3},{value:"<code>$product</code> \u2014 Multiplication",id:"product--multiplication",level:3},{value:"<code>$quotient</code> \u2014 Division",id:"quotient--division",level:3},{value:"<code>$remainder</code> \u2014 Modulo",id:"remainder--modulo",level:3},{value:"Reading values",id:"reading-values",level:2},{value:"<code>$read</code> \u2014 Read from a named region",id:"read--read-from-a-named-region",level:3},{value:"Region property lookups",id:"region-property-lookups",level:2},{value:"<code>.offset</code> \u2014 Region&#39;s offset",id:"offset--regions-offset",level:3},{value:"<code>.length</code> \u2014 Region&#39;s length",id:"length--regions-length",level:3},{value:"<code>.slot</code> \u2014 Region&#39;s slot",id:"slot--regions-slot",level:3},{value:"Chaining lookups",id:"chaining-lookups",level:3},{value:"Computing storage slots with <code>$keccak256</code>",id:"computing-storage-slots-with-keccak256",level:2},{value:"Array element slots",id:"array-element-slots",level:3},{value:"Mapping value slots",id:"mapping-value-slots",level:3},{value:"Nested mappings",id:"nested-mappings",level:3},{value:"Data manipulation",id:"data-manipulation",level:2},{value:"<code>$concat</code> \u2014 Concatenate bytes",id:"concat--concatenate-bytes",level:3},{value:"<code>$sized&lt;N&gt;</code> \u2014 resize to N bytes",id:"sizedn--resize-to-n-bytes",level:3},{value:"<code>$wordsized</code> \u2014 Resize to word size",id:"wordsized--resize-to-word-size",level:3},{value:"Variables in expressions",id:"variables-in-expressions",level:2},{value:"Complete example: dynamic array element",id:"complete-example-dynamic-array-element",level:2},{value:"Learn more",id:"learn-more",level:2}];function m(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"expressions",children:"Expressions"})}),"\n",(0,r.jsx)(o.A,{schema:"ethdebug/format/pointer/expression",href:"/spec/pointer/expression"}),"\n",(0,r.jsxs)(l.rM,{children:[(0,r.jsx)(t.p,{children:"Static offsets work for simple variables, but most interesting data has\nlocations that depend on runtime values. Expressions let pointers compute\naddresses dynamically."}),(0,r.jsx)(t.h2,{id:"why-expressions-are-needed",children:"Why expressions are needed"}),(0,r.jsxs)(t.p,{children:["Consider reading element ",(0,r.jsx)(t.code,{children:"i"})," from a memory array. The element's location\ndepends on:"]}),(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Where the array starts (might come from the free memory pointer)"}),"\n",(0,r.jsxs)(t.li,{children:["Which element we want (the index ",(0,r.jsx)(t.code,{children:"i"}),")"]}),"\n",(0,r.jsxs)(t.li,{children:["How big each element is (32 bytes for ",(0,r.jsx)(t.code,{children:"uint256"}),")"]}),"\n"]}),(0,r.jsx)(t.p,{children:"A static pointer can't capture this. Expressions can:"}),(0,r.jsx)(l.C,{title:"Array element access",pointer:{group:[{name:"array-start",location:"memory",offset:0,length:32},{define:{index:2},in:{name:"element",location:"memory",offset:{$sum:[{$read:"array-start"},{$product:["index",32]}]},length:32}}]},state:{memory:"0x00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003"},description:"Computes offset: array-start value (0x40) + index (2) \xd7 32 = 0x80"}),(0,r.jsx)(t.h2,{id:"arithmetic-expressions",children:"Arithmetic expressions"}),(0,r.jsx)(t.p,{children:"Basic math operations for computing addresses:"}),(0,r.jsxs)(t.h3,{id:"sum--addition",children:[(0,r.jsx)(t.code,{children:"$sum"})," \u2014 Addition"]}),(0,r.jsx)(t.p,{children:"Adds all values in an array:"}),(0,r.jsx)(l.C,{title:"$sum expression",pointer:{location:"storage",slot:{$sum:[100,32,4]}},state:{storage:{"0x88":"0x000000000000000000000000000000000000000000000000000000000000002a"}},description:"Computes slot: 100 + 32 + 4 = 136 (0x88)"}),(0,r.jsxs)(t.h3,{id:"difference--subtraction",children:[(0,r.jsx)(t.code,{children:"$difference"})," \u2014 Subtraction"]}),(0,r.jsx)(t.p,{children:"Subtracts the second value from the first (saturates at zero):"}),(0,r.jsx)(l.C,{title:"$difference expression",pointer:{location:"storage",slot:{$difference:[100,32]}},state:{storage:{"0x44":"0x000000000000000000000000000000000000000000000000000000000000002a"}},description:"Computes slot: 100 - 32 = 68 (0x44)"}),(0,r.jsxs)(t.h3,{id:"product--multiplication",children:[(0,r.jsx)(t.code,{children:"$product"})," \u2014 Multiplication"]}),(0,r.jsx)(t.p,{children:"Multiplies all values in an array:"}),(0,r.jsx)(l.C,{title:"$product expression",pointer:{location:"memory",offset:{$product:[32,10]},length:32},state:{memory:"0x"+"00".repeat(320)+"000000000000000000000000000000000000000000000000000000000000002a"},description:"Computes offset: 32 \xd7 10 = 320 (0x140)"}),(0,r.jsxs)(t.h3,{id:"quotient--division",children:[(0,r.jsx)(t.code,{children:"$quotient"})," \u2014 Division"]}),(0,r.jsx)(t.p,{children:"Integer division of first value by second:"}),(0,r.jsx)(l.C,{title:"$quotient expression",pointer:{location:"storage",slot:{$quotient:[100,32]}},state:{storage:{"0x03":"0x000000000000000000000000000000000000000000000000000000000000002a"}},description:"Computes slot: 100 \xf7 32 = 3"}),(0,r.jsxs)(t.h3,{id:"remainder--modulo",children:[(0,r.jsx)(t.code,{children:"$remainder"})," \u2014 Modulo"]}),(0,r.jsx)(t.p,{children:"Remainder after division:"}),(0,r.jsx)(l.C,{title:"$remainder expression",pointer:{location:"storage",slot:{$remainder:[100,32]}},state:{storage:{"0x04":"0x000000000000000000000000000000000000000000000000000000000000002a"}},description:"Computes slot: 100 mod 32 = 4"}),(0,r.jsx)(t.h2,{id:"reading-values",children:"Reading values"}),(0,r.jsxs)(t.h3,{id:"read--read-from-a-named-region",children:[(0,r.jsx)(t.code,{children:"$read"})," \u2014 Read from a named region"]}),(0,r.jsx)(t.p,{children:"Reads the bytes from a previously defined region:"}),(0,r.jsx)(l.C,{title:"$read expression",pointer:{group:[{name:"array-length-slot",location:"storage",slot:5},{name:"array-data",location:"storage",slot:{$keccak256:[{$wordsized:5}]},length:{$product:[{$read:"array-length-slot"},32]}}]},state:{storage:{"0x05":"0x0000000000000000000000000000000000000000000000000000000000000003","0x036b6384b5eca791c62761152d0c79bb0604c104a5fb6f4eb0703f3154bb3db0":"0x0000000000000000000000000000000000000000000000000000000000000001"}},description:"Reads array length (3) from slot 5, computes data length as 3 \xd7 32 = 96 bytes"}),(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"$read"})," expression retrieves the actual runtime value stored in the\n",(0,r.jsx)(t.code,{children:"array-length-slot"})," region\u2014the array's length."]}),(0,r.jsx)(t.h2,{id:"region-property-lookups",children:"Region property lookups"}),(0,r.jsxs)(t.p,{children:["Reference properties of named regions with ",(0,r.jsx)(t.code,{children:".property"})," syntax:"]}),(0,r.jsxs)(t.h3,{id:"offset--regions-offset",children:[(0,r.jsx)(t.code,{children:".offset"})," \u2014 Region's offset"]}),(0,r.jsx)(a.A,{schema:"pointer/expression",href:"/spec/pointer/expression",children:'{ ".offset": "previous-element" }'}),(0,r.jsx)(t.p,{children:"Returns the offset of the named region."}),(0,r.jsxs)(t.h3,{id:"length--regions-length",children:[(0,r.jsx)(t.code,{children:".length"})," \u2014 Region's length"]}),(0,r.jsx)(a.A,{schema:"pointer/expression",href:"/spec/pointer/expression",children:'{ ".length": "previous-element" }'}),(0,r.jsx)(t.p,{children:"Returns the length of the named region."}),(0,r.jsxs)(t.h3,{id:"slot--regions-slot",children:[(0,r.jsx)(t.code,{children:".slot"})," \u2014 Region's slot"]}),(0,r.jsx)(a.A,{schema:"pointer/expression",href:"/spec/pointer/expression",children:'{ ".slot": "base-slot" }'}),(0,r.jsx)(t.p,{children:"Returns the slot number for storage/stack/transient regions."}),(0,r.jsx)(t.h3,{id:"chaining-lookups",children:"Chaining lookups"}),(0,r.jsx)(t.p,{children:"Compute the next element's position from the previous one:"}),(0,r.jsx)(l.C,{title:"Chaining .offset and .length",pointer:{group:[{name:"element-0",location:"memory",offset:"0x80",length:32},{name:"element-1",location:"memory",offset:{$sum:[{".offset":"element-0"},{".length":"element-0"}]},length:32}]},state:{memory:"0x"+"00".repeat(128)+"00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002"},description:"element-1 offset = 0x80 + 32 = 0xa0"}),(0,r.jsxs)(t.h2,{id:"computing-storage-slots-with-keccak256",children:["Computing storage slots with ",(0,r.jsx)(t.code,{children:"$keccak256"})]}),(0,r.jsx)(t.p,{children:"Solidity uses keccak256 hashing to compute storage locations for dynamic data."}),(0,r.jsx)(t.h3,{id:"array-element-slots",children:"Array element slots"}),(0,r.jsxs)(t.p,{children:["For a dynamic array at slot ",(0,r.jsx)(t.code,{children:"n"}),", elements start at ",(0,r.jsx)(t.code,{children:"keccak256(n)"}),":"]}),(0,r.jsx)(l.C,{title:"Array element slot via keccak256",pointer:{define:{"element-index":2},in:{name:"element",location:"storage",slot:{$sum:[{$keccak256:[{$wordsized:5}]},"element-index"]}}},state:{storage:{"0x036b6384b5eca791c62761152d0c79bb0604c104a5fb6f4eb0703f3154bb3db2":"0x000000000000000000000000000000000000000000000000000000000000002a"}},description:"Computes: keccak256(5) + 2"}),(0,r.jsx)(t.h3,{id:"mapping-value-slots",children:"Mapping value slots"}),(0,r.jsxs)(t.p,{children:["For a mapping at slot ",(0,r.jsx)(t.code,{children:"n"}),", the value for key ",(0,r.jsx)(t.code,{children:"k"})," is at ",(0,r.jsx)(t.code,{children:"keccak256(k, n)"}),":"]}),(0,r.jsx)(l.C,{title:"Mapping slot via keccak256",pointer:{group:[{name:"key-region",location:"stack",slot:0},{name:"value",location:"storage",slot:{$keccak256:[{$read:"key-region"},{$wordsized:3}]}}]},state:{stack:["0x000000000000000000000000d8da6bf26964af9d7eed9e03e53415d37aa96045"],storage:{"0x8bd687de6e6aeb4c2d69c24f27b3ceeaf64b7f68aeb36f23bc3bfcfd9a5c4b0b":"0x0000000000000000000000000000000000000000000000000de0b6b3a7640000"}},description:"Computes: keccak256(key, 3) \u2014 standard Solidity mapping slot"}),(0,r.jsx)(t.h3,{id:"nested-mappings",children:"Nested mappings"}),(0,r.jsxs)(t.p,{children:["For ",(0,r.jsx)(t.code,{children:"mapping(address => mapping(uint => uint))"})," at slot 2:"]}),(0,r.jsx)(l.C,{title:"Nested mapping slot",pointer:{group:[{name:"outer-key",location:"stack",slot:0},{name:"inner-key",location:"stack",slot:1},{name:"value",location:"storage",slot:{$keccak256:[{$read:"inner-key"},{$keccak256:[{$read:"outer-key"},{$wordsized:2}]}]}}]},state:{stack:["0x000000000000000000000000d8da6bf26964af9d7eed9e03e53415d37aa96045","0x0000000000000000000000000000000000000000000000000000000000000001"],storage:{}},description:"Computes: keccak256(inner_key, keccak256(outer_key, 2))"}),(0,r.jsxs)(t.p,{children:["This computes: ",(0,r.jsx)(t.code,{children:"keccak256(inner_key, keccak256(outer_key, 2))"})]}),(0,r.jsx)(t.h2,{id:"data-manipulation",children:"Data manipulation"}),(0,r.jsxs)(t.h3,{id:"concat--concatenate-bytes",children:[(0,r.jsx)(t.code,{children:"$concat"})," \u2014 Concatenate bytes"]}),(0,r.jsx)(t.p,{children:"Joins byte sequences without padding:"}),(0,r.jsx)(l.C,{title:"$concat expression",pointer:{location:"storage",slot:{$keccak256:[{$concat:["0xdead","0xbeef"]}]}},state:{storage:{}},description:"Concatenates 0xdead + 0xbeef = 0xdeadbeef, then hashes"}),(0,r.jsx)(t.p,{children:"Useful for building hash inputs from multiple values."}),(0,r.jsxs)(t.h3,{id:"sizedn--resize-to-n-bytes",children:[(0,r.jsx)(t.code,{children:"$sized<N>"})," \u2014 resize to N bytes"]}),(0,r.jsx)(t.p,{children:"Truncates or pads to exactly N bytes:"}),(0,r.jsx)(l.C,{title:"$sized32 expression",pointer:{location:"storage",slot:{$keccak256:[{$sized32:"0x1234"}]}},state:{storage:{}},description:"Pads 0x1234 to 32 bytes before hashing"}),(0,r.jsx)(t.p,{children:"Pads with zeros on the left; truncates from the left if too long."}),(0,r.jsxs)(t.h3,{id:"wordsized--resize-to-word-size",children:[(0,r.jsx)(t.code,{children:"$wordsized"})," \u2014 Resize to word size"]}),(0,r.jsxs)(t.p,{children:["Equivalent to ",(0,r.jsx)(t.code,{children:"$sized32"})," on the EVM:"]}),(0,r.jsx)(l.C,{title:"$wordsized expression",pointer:{group:[{name:"some-region",location:"stack",slot:0},{name:"result",location:"storage",slot:{$keccak256:[{$wordsized:{$read:"some-region"}}]}}]},state:{stack:["0x0000000000000000000000000000000000000000000000000000000000000005"]},description:"Reads value from stack, pads to word size, then hashes"}),(0,r.jsx)(t.h2,{id:"variables-in-expressions",children:"Variables in expressions"}),(0,r.jsx)(t.p,{children:"Expressions can reference variables by name. These come from list pointer\ncontexts:"}),(0,r.jsx)(l.C,{title:"List variable in expression",pointer:{group:[{name:"array-length",location:"storage",slot:0},{list:{count:{$read:"array-length"},each:"i",is:{name:"element",location:"storage",slot:{$sum:[{$keccak256:[{$wordsized:0}]},"i"]}}}}]},state:{storage:{"0x00":"0x0000000000000000000000000000000000000000000000000000000000000003","0x290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563":"0x0000000000000000000000000000000000000000000000000000000000000001","0x290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e564":"0x0000000000000000000000000000000000000000000000000000000000000002","0x290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e565":"0x0000000000000000000000000000000000000000000000000000000000000003"}},description:"Variable 'i' takes values 0, 1, 2 computing each element's slot"}),(0,r.jsxs)(t.p,{children:["The variable ",(0,r.jsx)(t.code,{children:'"i"'})," takes values from 0 to count-1, computing each element's\nslot."]}),(0,r.jsx)(t.h2,{id:"complete-example-dynamic-array-element",children:"Complete example: dynamic array element"}),(0,r.jsxs)(t.p,{children:["Reading element ",(0,r.jsx)(t.code,{children:"i"})," from ",(0,r.jsx)(t.code,{children:"uint256[] storage arr"})," at slot 5:"]}),(0,r.jsx)(l.C,{title:"Dynamic array element",pointer:{group:[{name:"array-slot",location:"storage",slot:5},{define:{"element-index":2},in:{name:"element",location:"storage",slot:{$sum:[{$keccak256:[{$wordsized:{".slot":"array-slot"}}]},"element-index"]}}}]},state:{storage:{"0x05":"0x0000000000000000000000000000000000000000000000000000000000000003","0x036b6384b5eca791c62761152d0c79bb0604c104a5fb6f4eb0703f3154bb3db2":"0x000000000000000000000000000000000000000000000000000000000000002a"}},description:"Computes keccak256(5) + 2 to find element at index 2"}),(0,r.jsx)(t.p,{children:"The pointer:"}),(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Defines the array's base slot"}),"\n",(0,r.jsxs)(t.li,{children:["Computes the element's slot: ",(0,r.jsx)(t.code,{children:"keccak256(5) + element_index"})]}),"\n",(0,r.jsx)(t.li,{children:"Returns that storage location"}),"\n"]}),(0,r.jsx)(t.h2,{id:"learn-more",children:"Learn more"}),(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"./regions",children:"Regions documentation"})," for region structure"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"/spec/pointer/expression",children:"Expression specification"})," for the complete\nexpression language"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"/docs/implementation-guides/pointers/evaluating-expressions",children:"Implementation guide"}),"\nfor building an expression evaluator"]}),"\n"]})]})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(m,{...e})}):m(e)}},70396(e,t,n){var s;n.d(t,{B:()=>a,D:()=>p}),function(e){e.dereferencePointer=e=>({kind:"dereference-pointer",pointer:e}),e.saveRegions=e=>({kind:"save-regions",regions:e}),e.saveVariables=e=>({kind:"save-variables",variables:e}),e.pushRegionRenames=e=>({kind:"push-region-renames",mapping:e}),e.popRegionRenames=()=>({kind:"pop-region-renames"}),e.pushTemplates=e=>({kind:"push-templates",templates:e}),e.popTemplates=()=>({kind:"pop-templates"})}(s||(s={}));var r=n(31917),i=n(43568);const o=Symbol.for("nodejs.util.inspect.custom");class a extends Uint8Array{static zero(){return new a([])}static fromUint(e){if(0n===e)return this.zero();const t=Math.ceil(Number(e.toString(2).length)/8),n=new Uint8Array(t);for(let s=t-1;s>=0;s--)n[s]=Number(0xffn&e),e>>=8n;return new a(n)}static fromNumber(e){const t=Math.ceil(Math.log2(e+1)/8),n=new Uint8Array(t);for(let s=t-1;s>=0;s--)n[s]=255&e,e>>=8;return new a(n)}static fromHex(e){if(!e.startsWith("0x"))throw new Error('Invalid hex string format. Expected "0x" prefix.');const t=new Uint8Array((e.length-2)/2+.5);for(let n=2;n<e.length;n+=2)t[n/2-1]=parseInt(e.slice(n,n+2),16);return new a(t)}static fromBytes(e){return new a(e)}asUint(){const e=8n;let t=0n;for(const n of this.values()){t=(t<<e)+BigInt(n)}return t}toHex(){return`0x${(0,i.nj)(this)}`}padUntilAtLeast(e){if(this.length>=e)return this;const t=new Uint8Array(e);return t.set(this,e-this.length),a.fromBytes(t)}resizeTo(e){if(this.length===e)return this;const t=new Uint8Array(e);return this.length<e?t.set(this,e-this.length):t.set(this.slice(this.length-e)),a.fromBytes(t)}concat(...e){const t=[this,...e].map((e=>e.toHex().slice(2))).reduce(((e,t)=>`${e}${t}`),"0x");return a.fromHex(t)}inspect(e,t,n){return`Data[${t.stylize(this.toHex(),"number")}]`}[o](e,t,n){return this.inspect(e,t,n)}}async function l(e,t){const{location:n}=e,{state:s}=t;switch(n){case"stack":{const{slot:t,offset:n=0n,length:r=32n}=c(["slot","offset","length"],e);return await s.stack.peek({depth:t,slice:{offset:n,length:r}})}case"memory":{const{offset:t,length:n}=c(["offset","length"],e);return await s.memory.read({slice:{offset:t,length:n}})}case"storage":{const{slot:t}=e,{offset:n=0n,length:r=32n}=c(["offset","length"],e);return await s.storage.read({slot:t,slice:{offset:n,length:r}})}case"calldata":{const{offset:t,length:n}=c(["offset","length"],e);return await s.calldata.read({slice:{offset:t,length:n}})}case"returndata":{const{offset:t,length:n}=c(["offset","length"],e);return await s.returndata.read({slice:{offset:t,length:n}})}case"transient":{const{slot:t}=e,{offset:n=0n,length:r=32n}=c(["offset","length"],e);return await s.transient.read({slot:t,slice:{offset:n,length:r}})}case"code":{const{offset:t,length:n}=c(["offset","length"],e);return await s.code.read({slice:{offset:t,length:n}})}}}function c(e,t){const n={};for(const s of e){const e=t[s];void 0!==e&&(n[s]=e.asUint())}return n}var d=n(33688);async function u(e,t){if(r.gm.Expression.isLiteral(e))return async function(e){switch(typeof e){case"string":return a.fromHex(e);case"number":return a.fromNumber(e)}}(e);if(r.gm.Expression.isConstant(e))return async function(e){if("$wordsize"===e)return a.fromHex("0x20")}(e);if(r.gm.Expression.isVariable(e))return async function(e,{variables:t}){const n=t[e];if(void 0===n)throw new Error(`Unknown variable with identifier ${e}`);return n}(e,t);if(r.gm.Expression.isArithmetic(e)){if(r.gm.Expression.Arithmetic.isSum(e))return async function(e,t){const n=await Promise.all(e.$sum.map((async e=>await u(e,t)))),s=n.reduce(((e,{length:t})=>t>e?t:e),0);return a.fromUint(n.reduce(((e,t)=>e+t.asUint()),0n)).padUntilAtLeast(s)}(e,t);if(r.gm.Expression.Arithmetic.isDifference(e))return async function(e,t){const[n,s]=await Promise.all(e.$difference.map((async e=>await u(e,t)))),r=n.length>s.length?n.length:s.length,i=n.asUint()>s.asUint()?a.fromUint(n.asUint()-s.asUint()):a.fromNumber(0);return i.padUntilAtLeast(r)}(e,t);if(r.gm.Expression.Arithmetic.isProduct(e))return async function(e,t){const n=await Promise.all(e.$product.map((async e=>await u(e,t)))),s=n.reduce(((e,{length:t})=>t>e?t:e),0);return a.fromUint(n.reduce(((e,t)=>e*t.asUint()),1n)).padUntilAtLeast(s)}(e,t);if(r.gm.Expression.Arithmetic.isQuotient(e))return async function(e,t){const[n,s]=await Promise.all(e.$quotient.map((async e=>await u(e,t)))),r=n.length>s.length?n.length:s.length;return a.fromUint(n.asUint()/s.asUint()).padUntilAtLeast(r)}(e,t);if(r.gm.Expression.Arithmetic.isRemainder(e))return async function(e,t){const[n,s]=await Promise.all(e.$remainder.map((async e=>await u(e,t)))),r=n.length>s.length?n.length:s.length;return a.fromUint(n.asUint()%s.asUint()).padUntilAtLeast(r)}(e,t)}if(r.gm.Expression.isKeccak256(e))return async function(e,t){const n=await Promise.all(e.$keccak256.map((async e=>await u(e,t)))),s=a.zero().concat(...n);return a.fromBytes((0,d.So)(s))}(e,t);if(r.gm.Expression.isConcat(e))return async function(e,t){const n=await Promise.all(e.$concat.map((async e=>await u(e,t))));return a.zero().concat(...n)}(e,t);if(r.gm.Expression.isResize(e))return async function(e,t){const[[n,s]]=Object.entries(e),i=r.gm.Expression.Resize.isToNumber(e)?Number(n.match(/^\$sized([1-9]+[0-9]*)$/)[1]):32;return(await u(s,t)).resizeTo(i)}(e,t);if(r.gm.Expression.isLookup(e)){if(r.gm.Expression.Lookup.isOffset(e))return h(".offset",e,t);if(r.gm.Expression.Lookup.isLength(e))return h(".length",e,t);if(r.gm.Expression.Lookup.isSlot(e))return h(".slot",e,t)}if(r.gm.Expression.isRead(e))return async function(e,t){const{state:n,regions:s}=t,r=e.$read,i=s[r];if(!i)throw new Error(`Region not found: ${r}`);return await l(i,t)}(e,t);throw new Error(`Unexpected runtime failure to recognize kind of expression: ${JSON.stringify(e)}`)}async function h(e,t,n){const{regions:s}=n,i=t[e],o=s[i];if(!o)throw new Error(`Region not found: ${i}`);const a=r.gm.Expression.Lookup.propertyFrom(e),l=o[a];if(void 0===l)throw new Error(`Region named ${i} does not have ${a} needed by lookup`);return l}async function*m(e,t){if(r.gm.isRegion(e)){const n=e;return yield*async function*(e,{stackLengthChange:t,...n}){const i=await async function(e,t){const n={},s={},r=new Proxy({...e},{get(e,t){if(t in n)return n[t];throw new Error(`Property not evaluated yet: $this.${t.toString()}`)}}),i=["slot","offset","length"],o=i.filter((t=>t in e)).map((t=>[t,e[t]]));for(;o.length>0;){const[e,l]=o.shift();try{const s=await u(l,{...t,regions:{...t.regions,$this:r}});n[e]=s}catch(a){if(!(a instanceof Error&&a.message.startsWith("Property not evaluated yet: $this.")))throw a;{const t=s[e]||0;if(t>i.length-1)throw new Error(`Circular reference detected: $this.${e.toString()}`);s[e]=t+1,o.push([e,l])}}}return{...e,...n}}(function(e,t){if(r.gm.Region.isStack(e)){const n=0n===t?e.slot:t>0n?{$sum:[e.slot,`0x${t.toString(16)}`]}:{$difference:[e.slot,"0x"+-t.toString(16)]};return{...e,slot:n}}return e}(e,t),n);if(yield i,void 0!==e.name)return[s.saveRegions({[e.name]:i})];return[]}(n,t)}const n=e;if(r.gm.Collection.isGroup(n))return yield*async function*(e,t){const{group:n}=e;return n.map(s.dereferencePointer)}(n);if(r.gm.Collection.isList(n))return yield*async function*(e,t){const{list:n}=e,{count:r,each:i,is:o}=n,l=(await u(r,t)).asUint(),c=[];for(let d=0n;d<l;d++)c.push(s.saveVariables({[i]:a.fromUint(d)})),c.push(s.dereferencePointer(o));return c}(n,t);if(r.gm.Collection.isConditional(n))return yield*async function*(e,t){const{if:n,then:r,else:i}=e,o=(await u(n,t)).asUint();if(o)return[s.dereferencePointer(r)];return i?[s.dereferencePointer(i)]:[]}(n,t);if(r.gm.Collection.isScope(n))return yield*async function*(e,t){const{define:n,in:r}=e,i={...t.variables},o={};for(const[s,a]of Object.entries(n)){const e=await u(a,{...t,variables:i});i[s]=e,o[s]=e}return[s.saveVariables(o),s.dereferencePointer(r)]}(n,t);if(r.gm.Collection.isReference(n))return yield*async function*(e,t){const{template:n,yields:r}=e,{templates:i,variables:o}=t,a=i[n];if(!a)throw new Error(`Unknown pointer template named ${n}`);const{expect:l,for:c}=a,d=new Set(Object.keys(o)),u=l.filter((e=>!d.has(e)));if(u.length>0)throw new Error([`Invalid reference to template named ${n}; missing expected `,`variables with identifiers: ${u.join(", ")}. `,"Please ensure these variables are defined prior to this reference."].join(""));if(r&&Object.keys(r).length>0)return[s.pushRegionRenames(r),s.dereferencePointer(c),s.popRegionRenames()];return[s.dereferencePointer(c)]}(n,t);if(r.gm.Collection.isTemplates(n))return yield*async function*(e,t){const{templates:n,in:r}=e;return[s.pushTemplates(n),s.dereferencePointer(r),s.popTemplates()]}(n);throw console.error("%s",JSON.stringify(e,void 0,2)),new Error("Unexpected unknown kind of pointer")}async function p(e,t={}){const n=await async function({templates:e={},state:t}){const n=t?await t.stack.length:0n;return{templates:e,initialStackLength:n}}(t);return function(e){return{async view(t){const n=[];for await(const a of e(t))n.push(a);const s={},r={},i={writable:!1,enumerable:!1,configurable:!1},o=Object.create(Array.prototype,{length:{value:n.length,...i}});for(const[e,a]of n.entries())Object.defineProperty(o,e,{value:a,...i,enumerable:!0}),"string"==typeof a.name&&(a.name in s||(s[a.name]=[]),s[a.name].push(a),r[a.name]=a);for(const[e,a]of Object.entries(r))Object.defineProperty(o,e,{value:a,...i});return Object.defineProperties(o,{named:{value:e=>s[e]||[],...i},lookup:{value:{...r},...i}}),{regions:o,read:async e=>await l(e,{state:t})}}}}((t=>({async*[Symbol.asyncIterator](){yield*async function*(e,t){const n=await async function({templates:e,state:t,initialStackLength:n}){return{templates:e,state:t,stackLengthChange:await t.stack.length-n,regions:{},variables:{}}}(t),{regions:r,variables:i}=n,o=[],a=[],l=[s.dereferencePointer(e)];for(;l.length>0;){const e=l.pop();let t=[];switch(e.kind){case"dereference-pointer":{const s=a.reduce(((e,t)=>({...e,...t})),n.templates),r=m(e.pointer,{...n,templates:s});let i=await r.next();for(;!i.done;){let e=i.value;const t=o[o.length-1];if(t&&e.name){const n=t[e.name];n&&n!==e.name&&(e={...e,name:n})}yield e,i=await r.next()}t=i.value;break}case"save-regions":for(const[t,n]of Object.entries(e.regions))r[t]=n;break;case"save-variables":Object.assign(i,e.variables);break;case"push-region-renames":o.push(e.mapping);break;case"pop-region-renames":{const e=o.pop();if(e)for(const[t,n]of Object.entries(e))t in r&&n!==t&&(r[n]={...r[t],name:n});break}case"push-templates":a.push(e.templates);break;case"pop-templates":a.pop()}for(let n=t.length-1;n>=0;n--)l.push(t[n])}}(e,{...n,state:t})}})))}},87270(e,t,n){n.d(t,{A:()=>m});n(14041);var s=n(40665),r=n(54034),i=n.n(r);const o="container_eo8G",a="header_CGit",l="title_NhXp",c="schemaLink_R3qF",d="schemaName_hPpq",u="schemaLabel_TlZH";var h=n(31085);function m({schema:e,href:t,children:n,title:r}){const m="string"==typeof n?n:JSON.stringify(n,null,2),p=e.startsWith("ethdebug/format/")?e:`ethdebug/format/${e}`;return(0,h.jsxs)("div",{className:o,children:[(0,h.jsxs)("div",{className:a,children:[r&&(0,h.jsx)("span",{className:l,children:r}),(0,h.jsxs)(s.A,{to:t,className:c,children:[(0,h.jsx)("span",{className:u,children:"Schema:"}),(0,h.jsx)("span",{className:d,children:p})]})]}),(0,h.jsx)(i(),{language:"json",children:m})]})}}}]);