"use strict";(globalThis.webpackChunk_ethdebug_format_web=globalThis.webpackChunk_ethdebug_format_web||[]).push([[9605],{43221(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"programs/index","title":"Programs","description":"Programs describe the high-level context at each point in EVM bytecode","source":"@site/docs/programs/index.mdx","sourceDirName":"programs","slug":"/programs/","permalink":"/format/pr-preview/pr-168/docs/programs/","draft":false,"unlisted":false,"editUrl":"https://github.com/ethdebug/format/tree/main/packages/web/docs/programs/index.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Collections","permalink":"/format/pr-preview/pr-168/docs/pointers/collections"},"next":{"title":"Instructions","permalink":"/format/pr-preview/pr-168/docs/programs/instructions"}}');var t=s(31085),i=s(71184);const c={sidebar_position:1},o="Programs",a={},l=[{value:"What programs contain",id:"what-programs-contain",level:2},{value:"Instructions carry context",id:"instructions-carry-context",level:2},{value:"How debuggers use programs",id:"how-debuggers-use-programs",level:2},{value:"Example: Simple instruction",id:"example-simple-instruction",level:2},{value:"Example: Instruction with variables",id:"example-instruction-with-variables",level:2},{value:"Context accumulates",id:"context-accumulates",level:2},{value:"What&#39;s next",id:"whats-next",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"programs",children:"Programs"})}),"\n",(0,t.jsx)(n.p,{children:"Programs describe the high-level context at each point in EVM bytecode\nexecution. They're the bridge between raw machine instructions and the\nsource code developers wrote."}),"\n",(0,t.jsx)(n.h2,{id:"what-programs-contain",children:"What programs contain"}),"\n",(0,t.jsx)(n.p,{children:"A program record corresponds to one block of executable bytecode\u2014either a\ncontract's runtime code (executed when called) or its creation code (executed\nduring deployment)."}),"\n",(0,t.jsx)(n.p,{children:"Each program contains:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Contract metadata"}),": which contract this bytecode belongs to"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Instruction list"}),": one entry per bytecode instruction, in order"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"instructions-carry-context",children:"Instructions carry context"}),"\n",(0,t.jsx)(n.p,{children:"The instruction list is the heart of a program. Each instruction record\nprovides:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Byte offset"}),": where this instruction appears in the bytecode (equivalent\nto program counter on pre-EOF EVMs)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Context information"}),": high-level details valid after this instruction\nexecutes"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Context information may include:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Source ranges"}),": which lines of source code this instruction relates to"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Variables"}),": what variables are in scope and where their values live"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Control flow hints"}),": whether this instruction is part of a function call,\nreturn, or other high-level operation"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"how-debuggers-use-programs",children:"How debuggers use programs"}),"\n",(0,t.jsx)(n.p,{children:"When stepping through EVM execution, a debugger:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Observes the current program counter"}),"\n",(0,t.jsx)(n.li,{children:"Looks up the corresponding instruction in the program"}),"\n",(0,t.jsx)(n.li,{children:"Uses the context to update its model of the high-level state"}),"\n",(0,t.jsx)(n.li,{children:"Presents source code, variables, and call stacks to the developer"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Each instruction's context acts as a state transition\u2014a compile-time guarantee\nabout what's true after that instruction runs."}),"\n",(0,t.jsx)(n.h2,{id:"example-simple-instruction",children:"Example: Simple instruction"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "offset": 42,\n  "context": {\n    "code": {\n      "source": {\n        "id": 0,\n        "range": {\n          "start": { "line": 15, "column": 4 },\n          "end": { "line": 15, "column": 28 }\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:'This says: "The instruction at byte 42 corresponds to line 15, columns 4-28\nof source file 0."'}),"\n",(0,t.jsx)(n.h2,{id:"example-instruction-with-variables",children:"Example: Instruction with variables"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "offset": 100,\n  "context": {\n    "code": {\n      "source": { "id": 0, "range": { ... } }\n    },\n    "variables": [\n      {\n        "name": "balance",\n        "type": { "kind": "uint", "bits": 256 },\n        "pointer": {\n          "location": "stack",\n          "slot": 0\n        }\n      }\n    ]\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["After instruction 100, the variable ",(0,t.jsx)(n.code,{children:"balance"})," is in scope and its value is at\nthe top of the stack."]}),"\n",(0,t.jsx)(n.h2,{id:"context-accumulates",children:"Context accumulates"}),"\n",(0,t.jsx)(n.p,{children:"Not every instruction needs complete context. The format supports incremental\nupdates:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:'"pick"'})}),": select from multiple possible contexts based on runtime\nconditions"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:'"gather"'})}),": combine contexts (like nested scopes)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:'"remark"'})}),": add metadata without changing variable scope"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This lets compilers emit compact debugging info that debuggers expand at\nruntime."}),"\n",(0,t.jsx)(n.h2,{id:"whats-next",children:"What's next"}),"\n",(0,t.jsxs)("div",{className:"row",children:[(0,t.jsx)("div",{className:"col col--6",children:(0,t.jsxs)("div",{className:"card margin-bottom--md",children:[(0,t.jsx)("div",{className:"card__header",children:(0,t.jsx)("h3",{children:"Instructions"})}),(0,t.jsx)("div",{className:"card__body",children:(0,t.jsx)("p",{children:"How instruction records map bytecode to source."})}),(0,t.jsx)("div",{className:"card__footer",children:(0,t.jsx)("a",{className:"button button--secondary button--block",href:"./instructions",children:(0,t.jsx)(n.p,{children:"Learn more \u2192"})})})]})}),(0,t.jsx)("div",{className:"col col--6",children:(0,t.jsxs)("div",{className:"card margin-bottom--md",children:[(0,t.jsx)("div",{className:"card__header",children:(0,t.jsx)("h3",{children:"Variables"})}),(0,t.jsx)("div",{className:"card__body",children:(0,t.jsx)("p",{children:"Connecting identifiers to runtime locations."})}),(0,t.jsx)("div",{className:"card__footer",children:(0,t.jsx)("a",{className:"button button--secondary button--block",href:"./variables",children:(0,t.jsx)(n.p,{children:"Learn more \u2192"})})})]})})]}),"\n",(0,t.jsxs)("div",{className:"row",children:[(0,t.jsx)("div",{className:"col col--6",children:(0,t.jsxs)("div",{className:"card margin-bottom--md",children:[(0,t.jsx)("div",{className:"card__header",children:(0,t.jsx)("h3",{children:"Tracing execution"})}),(0,t.jsx)("div",{className:"card__body",children:(0,t.jsx)("p",{children:"Using programs to inspect variables during execution."})}),(0,t.jsx)("div",{className:"card__footer",children:(0,t.jsx)("a",{className:"button button--secondary button--block",href:"./tracing",children:(0,t.jsx)(n.p,{children:"Learn more \u2192"})})})]})}),(0,t.jsx)("div",{className:"col col--6",children:(0,t.jsxs)("div",{className:"card margin-bottom--md",children:[(0,t.jsx)("div",{className:"card__header",children:(0,t.jsx)("h3",{children:"Full specification"})}),(0,t.jsx)("div",{className:"card__body",children:(0,t.jsx)("p",{children:"Complete JSON schemas for programs, instructions, and contexts."})}),(0,t.jsx)("div",{className:"card__footer",children:(0,t.jsx)("a",{className:"button button--secondary button--block",href:"/spec/program",children:(0,t.jsx)(n.p,{children:"View spec \u2192"})})})]})})]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);