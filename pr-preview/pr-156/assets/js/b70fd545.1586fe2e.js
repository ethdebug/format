(self.webpackChunk_ethdebug_format_web=self.webpackChunk_ethdebug_format_web||[]).push([[1685],{41374:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>d});var i=n(52322),s=n(45392),o=n(61376);const r={sidebar_position:3},c="Invoking the compiler",a={id:"implementation-guides/pointers/testing/compilation",title:"Invoking the compiler",description:"In being able to test a pointer dereference implementation, it is necessary to",source:"@site/docs/implementation-guides/pointers/testing/compilation.mdx",sourceDirName:"implementation-guides/pointers/testing",slug:"/implementation-guides/pointers/testing/compilation",permalink:"/format/pr-preview/pr-156/docs/implementation-guides/pointers/testing/compilation",draft:!1,unlisted:!1,editUrl:"https://github.com/ethdebug/format/tree/main/packages/web/docs/implementation-guides/pointers/testing/compilation.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"docsSidebar",previous:{title:"Finding example pointers",permalink:"/format/pr-preview/pr-156/docs/implementation-guides/pointers/testing/example-pointers"},next:{title:"Simulating a blockchain",permalink:"/format/pr-preview/pr-156/docs/implementation-guides/pointers/testing/blockchain-simulation"}},l={},d=[{value:"Integration logic",id:"integration-logic",level:2},{value:"The <code>CompileOptions</code> interface",id:"the-compileoptions-interface",level:2},{value:"&quot;Syntactic sugar&quot;-like helper function",id:"syntactic-sugar-like-helper-function",level:2}];function p(e){const t={code:"code",h1:"h1",h2:"h2",p:"p",strong:"strong",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h1,{id:"invoking-the-compiler",children:"Invoking the compiler"}),"\n",(0,i.jsxs)(t.p,{children:["In being able to test a pointer dereference implementation, it is necessary to\npair each tested pointer with associated EVM code that makes the pointer\nmeaningful. To avoid solutions such as pre-compiling Solidity or handwriting EVM\nbytecode, the ",(0,i.jsx)(t.strong,{children:"@ethdebug/pointers"})," reference implementation's integration\ntests are written so that each test case is described in terms of Solidity code\nthat the testing infrastructure compiles when executing the test."]}),"\n",(0,i.jsxs)(t.p,{children:["The strategy taken by these tests is to use Solidity's ",(0,i.jsx)(t.code,{children:"constructor"})," mechanism\nfor allowing tests to specify variable assignment and mutation logic without\nneeding to manage deployed contract instances. All these integration test cases\nthus observe pointers only via the trace of a contract creation transaction."]}),"\n",(0,i.jsx)(t.h2,{id:"integration-logic",children:"Integration logic"}),"\n",(0,i.jsxs)(t.p,{children:["This testing infrastructure includes the ",(0,i.jsx)(t.code,{children:"compileCreateBytecode()"})," function,\nwhich accepts input resembling Solidity's compiler input data as argument (i.e.,\nthe collection of source contents by path and additional contract target\ninformation) and asynchronously returns ",(0,i.jsx)(t.code,{children:"Data"})," with the create (deployment)\nbytecode for the target contract."]}),"\n",(0,i.jsx)(o.Z,{packageName:"@ethdebug/pointers",sourcePath:"test/solc.ts",extract:e=>e.getFunction("compileCreateBytecode")}),"\n",(0,i.jsxs)(t.h2,{id:"the-compileoptions-interface",children:["The ",(0,i.jsx)(t.code,{children:"CompileOptions"})," interface"]}),"\n",(0,i.jsx)(o.Z,{packageName:"@ethdebug/pointers",sourcePath:"test/solc.ts",extract:e=>e.getInterface("CompileOptions")}),"\n",(0,i.jsx)(t.h2,{id:"syntactic-sugar-like-helper-function",children:'"Syntactic sugar"-like helper function'}),"\n",(0,i.jsxs)(t.p,{children:["To avoid test cases' needing to describe their associated code samples in terms\nof source content by path, test cases that require only a single source file can\nuse the ",(0,i.jsx)(t.code,{children:"singleSourceCompilation()"})," helper function that provides a more\nsuccinct method for generating ",(0,i.jsx)(t.code,{children:"CompileOptions"})," objects:"]}),"\n",(0,i.jsx)(o.Z,{packageName:"@ethdebug/pointers",sourcePath:"test/solc.ts",extract:e=>e.getFunction("singleSourceCompilation")})]})}function u(e={}){const{wrapper:t}={...(0,s.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},48313:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=48313,e.exports=t},61376:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m});var i=n(84560),s=n.n(i),o=n(20477),r=n(42408);var c=n(2784),a=n(27718),l=n(52322);function d(e){let{code:t,links:n,...i}=e;const o=(0,c.useRef)(null),[r,a]=(0,c.useState)(null);return(0,c.useEffect)((()=>{function e(){if(o.current){const e=o.current.querySelector("pre > code");if(e){const t=Array.from(e.childNodes).flatMap((e=>p(e,n)));a((0,l.jsx)("pre",{className:e.parentElement?.className,children:(0,l.jsx)("code",{className:e.className,children:t})}))}}}e();const t=new MutationObserver(e);return o.current&&t.observe(o.current,{childList:!0,subtree:!0}),()=>t.disconnect()}),[t,n]),r||(0,l.jsx)("div",{ref:o,children:(0,l.jsx)(s(),{...i,children:t})})}function p(e,t){return e.nodeType===Node.TEXT_NODE?function(e,t){const n=[];let i=e.textContent||"",s=0;for(const[o,r]of Object.entries(t)){let e=i.indexOf(o,s);for(;-1!==e;)e>s&&n.push(i.slice(s,e)),n.push((0,l.jsx)(a.Z,{to:r,className:"linked-code-block-link",children:o},`${o}-${e}`)),s=e+o.length,e=i.indexOf(o,s)}s<i.length&&n.push(i.slice(s));return n}(e,t):e.nodeType===Node.ELEMENT_NODE?function(e,t){const n=e.tagName.toLowerCase(),i={key:u++,className:e.className};e.style&&e.style.cssText&&(i.style=function(e){const t={};for(const n of e.split(";"))if(n){const[e,i]=n.split(":");if(e&&i){t[e.trim().replace(/-./g,(e=>e[1].toUpperCase()))]=i.trim()}}return t}(e.style.cssText));if(h.has(n))return c.createElement(n,i);const s=Array.from(e.childNodes).flatMap((e=>p(e,t)));return c.createElement(n,i,s)}(e,t):[]}let u=0;const h=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"]);function m(e){let{packageName:t,sourcePath:n,includePackageNameInTitle:i=!1,extract:c,links:a={},...p}=e;const u=function(e){const{packages:t}=(0,r.eZ)("project-code-plugin");if(!(e in t))throw new Error(`Unknown package name ${e}`);const{sourceFiles:n}=t[e],i=new o.IKL({useInMemoryFileSystem:!0});for(const{filePath:s,text:o}of n)i.createSourceFile(s,o,{overwrite:!0});return i}(t),h=u.getSourceFileOrThrow(n),m=c?c(h,u):h,g=m.getFullText().trim(),f=!c,x=i?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("strong",{children:t})," ",n]}):n;return Object.keys(a).length>0?(0,l.jsx)(d,{code:g,links:a,language:"typescript",...p}):(0,l.jsx)(s(),{language:"typescript",...f?{title:x,showLineNumbers:!0}:{showLineNumbers:!1},...p,children:m.getFullText().trim()})}},56699:()=>{},68379:()=>{},68382:()=>{},78867:()=>{},21212:()=>{},89854:()=>{},25800:()=>{},93037:()=>{},26996:()=>{}}]);