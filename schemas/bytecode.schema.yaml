$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "schema:ethdebug/format/bytecode"

title: ethdebug/format/bytecode
description: |
  A schema for representing the information pertaining to a particular bytecode
  for a contract.

type: object

properties:
  context:
    description: |
      The context known to exist prior to the execution of the first
      instruction in the bytecode.
    $ref: "schema:ethdebug/format/context"

  instructions:
    type: object
    description: |
      A mapping from instruction byte offset to instruction annotation.

      For legacy contract bytecode (non-EOF), keys in this mapping are
      equivalent to the instruction's program counter. For EOF bytecode, keys
      in this mapping are byte offsets relative to _the start of the
      container_ (since program counters within EOF are relative to the start of
      individual code sections within the container).

      Keys in this mapping **must** be specified as `0x`-prefixed hexadecimal
      strings. Keys **may** vary in bytes length and avoid left-padding with
      zeroes, except that keys **must** represent at least one byte (`0x` is
      not allowed).
    patternProperties:
      "^0x[0-9a-fA-F]{1,}$":
        $ref: "schema:ethdebug/format/bytecode/instruction"
    additionalProperties: false

  types:
    type: object
    description: |
      A collection of types by name identifier. This field is optional and
      **may** be used by compilers that wish to minimize the size of output
      debugging data by de-duplicating type representations.
    additionalProperties:
      $ref: "schema:ethdebug/format/type"

required:
  - instructions

examples:
  - types:
      "my-bool":
        kind: bool
    instructions:
      "0x00":
        operation:
          mnemonic: PUSH1
          arguments: ["0x60"]
        context:
          variables:
            - identifier: paused
              declaration:
                source:
                  id: 5
                range:
                  offset: 10
                  length: 30
              type:
                id: "my-bool"
              pointer:
                location: storage
                slot: 0
