"use strict";(globalThis.webpackChunk_ethdebug_format_web=globalThis.webpackChunk_ethdebug_format_web||[]).push([[9571],{967(e,t,n){n.r(t),n.d(t,{assets:()=>L,contentTitle:()=>R,default:()=>U,frontMatter:()=>M,metadata:()=>o,toc:()=>T});const o=JSON.parse('{"id":"program/example","title":"Example program","description":"<ProgramExampleContextProvider","source":"@site/spec/program/example.mdx","sourceDirName":"program","slug":"/program/example","permalink":"/format/spec/program/example","draft":false,"unlisted":false,"editUrl":"https://github.com/ethdebug/format/tree/main/packages/web/spec/program/example.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Key concepts","permalink":"/format/spec/program/concepts"},"next":{"title":"Schema","permalink":"/format/spec/program/"}}');var i=n(31085),r=n(71184),s=n(14041);function a(e,t){const n=function(e,{sources:t}){if("function"!=typeof e)return e;const n=(e,n={})=>{const o="source"in n&&n.source?t.find((e=>e.id===n.source?.id)):t[0];if(!o)return;const i=n.after||"",r=o.contents.indexOf(i);if(-1===r)throw new Error(`Unexpected could not find string ${n.after} as prior occurrence to ${e}`);const s=r+i.length,a=o.contents.indexOf(e,s);if(-1===a)throw new Error(`Unexpected could not find string ${e}`);const c=e.length;return{source:{id:o.id},range:{offset:a,length:c}}};return e({findSourceRange:n})}(e.context,t);return{...e,context:n}}const c=(0,s.createContext)(void 0);function l(){const e=(0,s.useContext)(c);if(void 0===e)throw new Error("useProgramExampleContext must be used within a ProgramExampleContextProvider");return e}function d({children:e,...t}){const{sources:n,instructions:o}=t,r=function(e){const{results:t}=e.reduce((({nextOffset:e,results:t},n)=>{const o={offset:e,...n};return{nextOffset:e+(1+Math.ceil((n.operation.arguments||[]).map((e=>"number"==typeof e?e.toString(16):e.slice(2))).join("").length/2)),results:[...t,o]}}),{nextOffset:0,results:[]});return t}(o),l=r.map((e=>a(e,{sources:n}))),[d,u]=(0,s.useState)(),[h,g]=(0,s.useState)(),[f,p]=(0,s.useState)("simple");return(0,s.useEffect)((()=>{if(void 0===d)return void g(void 0);const e=l.find((({offset:e})=>e===d));if(!e)throw new Error(`Unexpected could not find instruction with offset ${d}`);g(e)}),[d,g]),(0,i.jsx)(c.Provider,{value:{sources:n,instructions:l,highlightedInstruction:h,highlightInstruction:u,highlightMode:f,showDetails:()=>p("detailed"),hideDetails:()=>p("simple")},children:e})}var u=n(20994),h=n(29755);function g(){const[e,t]=(0,s.useState)();return(0,s.useEffect)((()=>{(async function(){const e=await u.tz({themes:[n.e(5965).then(n.bind(n,5965))],langs:[n.e(1147).then(n.bind(n,51147)),n.e(5065).then(n.bind(n,15065))],engine:(0,h.Mk)(n.e(999).then(n.bind(n,999)))}),t="github-light";return{highlight:(n,{language:o,decorations:i})=>e.codeToHtml(n,{lang:o||"text",theme:t,decorations:i})}})().then(t)}),[t]),e}function f({code:e,...t}){const n=g();if(!n)return(0,i.jsx)(i.Fragment,{children:"Loading..."});const o=n.highlight(e,t);return(0,i.jsx)("div",{dangerouslySetInnerHTML:{__html:o}})}var p=n(31917);function m(e){const{sources:t,highlightedInstruction:n,highlightMode:o}=l();if(1!==t.length)throw new Error("Multiple sources per example not currently supported");const r=t[0],s=n?.context,a=p.BP.Context.isCode(s)?x(s,r):p.BP.Context.isPick(s)?function({pick:e},t){if(!e.every(p.BP.Context.isCode))return console.warn("decoratePickContext encountered non-code contexts in pick array. These will be ignored."),[];return e.flatMap((e=>x(e,t,"highlighted-ambiguous-code")))}(s,r):[],c=[...a,...p.BP.Context.isVariables(s)?b(s,r):[]],d="detailed"===o?c:a;return(0,i.jsx)(f,{className:"source-contents",code:r.contents,language:"javascript",decorations:d,...e})}function x({code:e},t,n="highlighted-code"){const{offset:o,length:i}=v(e.range,t);return[{start:o,end:o+i,properties:{class:n}}]}function b({variables:e},t){return e.map((({declaration:e})=>{const{offset:n,length:o}=v(e?.range,t);return{start:n,end:n+o,properties:{class:"highlighted-variable-declaration"}}}))}function v(e,t){const{offset:n,length:o}=e?{offset:Number(e.offset),length:Number(e.length)}:{offset:0,length:t.contents.length};return{offset:n,length:o}}function j(){const{instructions:e,highlightedInstruction:t,highlightInstruction:n,highlightMode:o,showDetails:r,hideDetails:a}=l(),[c,d]=(0,s.useState)(),[u,h]=(0,s.useState)();(0,s.useEffect)((()=>{if(void 0!==c)return t?.offset!==c&&n(c),void("simple"===o&&r());"detailed"===o&&a(),void 0===u?n(void 0):t?.offset!==u&&n(u)}),[c,u,t,o]);const g=e.at(-1).offset.toString(16).length;return(0,i.jsx)("dl",{className:"opcodes",children:e.map((e=>(0,i.jsx)(V,{instruction:e,active:c===e.offset,paddingLength:g,onClick:()=>{return t=e.offset,d(t===c?void 0:t);var t},onMouseEnter:()=>{return t=e.offset,h(t);var t},onMouseLeave:()=>(e.offset,h(void 0))},e.offset)))})}function V(e){const{instruction:t,active:n,paddingLength:o,onClick:r,onMouseEnter:s,onMouseLeave:a}=e,{offset:c,operation:l,context:d}=t,u=(0,i.jsxs)(i.Fragment,{children:["0x",c.toString(16).padStart(o,"0")]}),h=d&&"remark"in d?(0,i.jsxs)(i.Fragment,{children:[" (",d.remark,")"]}):(0,i.jsx)(i.Fragment,{}),g=(0,i.jsxs)(i.Fragment,{children:[l&&(0,i.jsx)("code",{children:[l.mnemonic,...l.arguments||[]].join(" ")}),h]});return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("dt",{className:n?"active":"",onClick:r,onMouseEnter:s,onMouseLeave:a,title:"Click for more instruction details",children:u}),(0,i.jsx)("dd",{onMouseEnter:s,onMouseLeave:a,children:g})]})}function k(){const{highlightedInstruction:e}=l();return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(f,{language:"javascript",code:JSON.stringify(e,void 0,2)})})}var y=n(42857),S=n(40665);function w(e){const{highlightedInstruction:t,highlightMode:n}=l();return"simple"!==n&&t?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h3",{children:"Details"}),(0,i.jsx)(P,{instruction:t}),(0,i.jsxs)("details",{children:[(0,i.jsxs)("summary",{children:["See full ",(0,i.jsx)("strong",{children:"ethdebug/format/program/instruction"})," object"]}),(0,i.jsx)(k,{})]})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h3",{children:"Details"}),(0,i.jsx)(E,{})]})}function P({instruction:e}){return(0,i.jsxs)(y.A,{type:"info",children:[(0,i.jsxs)("p",{children:["The selected instruction provides the following"," ",(0,i.jsxs)(S.A,{to:"/spec/program/context",children:[(0,i.jsx)("strong",{children:"ethdebug/format"})," Program contexts"]}),":"]}),(0,i.jsxs)("ul",{children:[(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Code context"})," is highlighted"," ",(0,i.jsx)("span",{className:"highlighted-code",children:"in this style"})," above."]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Variables context"})," is indicated by variable declarations highlighted"," ",(0,i.jsx)("span",{className:"highlighted-variable-declaration",children:"in this style"})," ","above."]})]})]})}function E(e){return(0,i.jsxs)(y.A,{type:"tip",children:["Select an instruction offset to see associated"," ",(0,i.jsx)("strong",{children:"ethdebug/format"})," debugging information."]})}function C(e){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h2",{children:"Interactive example"}),(0,i.jsxs)("div",{className:"viewer-row",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{id:"source-contents",children:"Source contents"}),(0,i.jsx)(m,{})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{id:"compiled-opcodes",children:"Compiled opcodes"}),(0,i.jsx)(j,{})]})]}),(0,i.jsx)(w,{})]})}const M={sidebar_position:3},R="Example program",L={},T=[];function I(e){const t={a:"a",h1:"h1",header:"header",p:"p",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"example-program",children:"Example program"})}),"\n",(0,i.jsxs)(d,{sources:[{id:0,path:"PaidIncrementer.eg",language:"examplelang",contents:"name PaidIncrementer;\n\n// define storage layout to include variable\n// at slot 0\nstorage {\n  [0] storedValue: uint256;\n}\n\n// runtime logic\ncode {\n  // require fee for incrementing\n  if (msg.callvalue < 3 finney) {\n    return;\n  }\n\n  let localValue = storedValue + 1;\n  storedValue = localValue;\n  return;\n}\n"}],instructions:[{operation:{mnemonic:"PUSH6",arguments:["0x02ba7def3000"]},context:({findSourceRange:e})=>({code:e("3 finney"),variables:[{identifier:"storedValue",type:{kind:"uint",bits:256},pointer:{location:"storage",slot:0},declaration:e("[0] storedValue: uint256")}],remark:"hexadecimal for 3 finney"})},{operation:{mnemonic:"CALLVALUE"},context:({findSourceRange:e})=>({code:e("msg.callvalue"),variables:[{identifier:"storedValue",type:{kind:"uint",bits:256},pointer:{location:"storage",slot:0},declaration:e("[0] storedValue: uint256")}]})},{operation:{mnemonic:"LT"},context:({findSourceRange:e})=>({code:e("msg.callvalue < 3 finney"),variables:[{identifier:"storedValue",type:{kind:"uint",bits:256},pointer:{location:"storage",slot:0},declaration:e("[0] storedValue: uint256")}]})},{operation:{mnemonic:"PUSH1",arguments:["0x13"]},context:({findSourceRange:e})=>({code:e("if (msg.callvalue < 3 finney) {\n    return;\n  }"),variables:[{identifier:"storedValue",type:{kind:"uint",bits:256},pointer:{location:"storage",slot:0},declaration:e("[0] storedValue: uint256")}]})},{operation:{mnemonic:"JUMPI"},context:({findSourceRange:e})=>({code:e("if (msg.callvalue < 3 finney) {\n    return;\n  }"),variables:[{identifier:"storedValue",type:{kind:"uint",bits:256},pointer:{location:"storage",slot:0},declaration:e("[0] storedValue: uint256")}],remark:"jump to end unless sufficient fee"})},{operation:{mnemonic:"PUSH0"},context:({findSourceRange:e})=>({code:e("storedValue",{after:"localValue ="}),variables:[{identifier:"storedValue",type:{kind:"uint",bits:256},pointer:{location:"storage",slot:0},declaration:e("[0] storedValue: uint256")}],remark:"push stack slot of state variable"})},{operation:{mnemonic:"SLOAD"},context:({findSourceRange:e})=>({code:e("storedValue",{after:"let localValue"}),variables:[{identifier:"storedValue",type:{kind:"uint",bits:256},pointer:{location:"storage",slot:0},declaration:e("[0] storedValue: uint256")}]})},{operation:{mnemonic:"PUSH1",arguments:["0x01"]},context:({findSourceRange:e})=>({code:e("1"),variables:[{identifier:"storedValue",type:{kind:"uint",bits:256},pointer:{location:"storage",slot:0},declaration:e("[0] storedValue: uint256")}]})},{operation:{mnemonic:"ADD"},context:({findSourceRange:e})=>({code:e("let localValue = storedValue + 1;"),variables:[{identifier:"storedValue",type:{kind:"uint",bits:256},pointer:{location:"storage",slot:0},declaration:e("[0] storedValue: uint256")},{identifier:"localValue",type:{kind:"uint",bits:256},pointer:{location:"stack",slot:0},declaration:e("let localValue")}]})},{operation:{mnemonic:"PUSH0"},context:({findSourceRange:e})=>({code:e("storedValue ="),variables:[{identifier:"storedValue",type:{kind:"uint",bits:256},pointer:{location:"storage",slot:0},declaration:e("[0] storedValue: uint256")},{identifier:"localValue",type:{kind:"uint",bits:256},pointer:{location:"stack",slot:1},declaration:e("let localValue")}]})},{operation:{mnemonic:"SSTORE"},context:({findSourceRange:e})=>({code:e("storedValue = localValue;"),variables:[{identifier:"storedValue",type:{kind:"uint",bits:256},pointer:{location:"storage",slot:0},declaration:e("[0] storedValue: uint256")}]})},{operation:{mnemonic:"JUMPDEST"},context:({findSourceRange:e})=>({pick:[{code:e("return;")},{code:e("return;",{after:"return;"})}]})}],children:[(0,i.jsxs)(t.p,{children:["This page helps illustrate the program schema's\n",(0,i.jsx)(t.a,{href:"/spec/program/concepts",children:"key concepts"})," by offering a fictional\npseudo-code example and its hypothetical compiled program."]}),(0,i.jsx)(t.p,{children:"Assume this fictional [somewhat] high-level language expects one contract per\nsource file, where each contract defines its storage layout, high-level logic,\nand other metadata as top-level statements or blocks."}),(0,i.jsx)(t.p,{children:"The following source code might be used to define a contract that\nincrements a state variable if the caller pays at least 1 finney (0.001 ETH)."}),(0,i.jsx)(C,{})]})]})}function U(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(I,{...e})}):I(e)}}}]);